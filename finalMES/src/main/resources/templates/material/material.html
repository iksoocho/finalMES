<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8" />
<title>자재 관리^^</title>
<style>
button {
	float: right;
	margin-right: 5px;
	margin-bottom: 10px;
}

table {
	border-collapse: collapse;
	width: 20%; /* 크기를 조정합니다 */
}

th {
	background-color: #f2f2f2;
	color: #333;
	font-weight: bold;
	padding: 8px;
	text-align: left;
}

td {
	padding: 8px;
	border-bottom: 1px solid #ddd;
}

input[type="text"] {
	width: 20%;
	padding: 8px;
	border: 1px solid #ccc;
	border-radius: 4px;
	box-sizing: border-box;
}

input[type="text"]:focus {
	outline: none;
	border-color: #4CAF50;
}
</style>
</head>
<body>
	<section layout:fragment="content" class="m-5">
		<div>
		<h2>자재 조회</h2>
			<div>

				<input type="text" id="searchOrder" oninput="searchFunction()"
					placeholder="검색...">
			</div>
			<br>

			<div class="row">
				<div class="col-7">
					<div id="matGrid" class="container">
						<h3>자재 전체 재고</h3>
					</div>
				</div>
				<div class="col-5">
					<div id="lotGrid" class="container">
						<h3>LOT 별 자재 재고</h3>
					</div>
				</div>
			</div>
		</div>
		<script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function () {
	        let matList = [[${matList}]];
            let matGrid = new tui.Grid({
                el: document.getElementById('matGrid'),
                data: matList,
                scrollX: false,
                scrollY: false,
                columns: [
                    {
                        header: '자재코드',
                        name: 'matCode',
                        align: 'center',
                        sortable: true, sortingType: 'desc' 
                    },
                    {
                        header: '자재명',
                        name: 'matName'
                    },
                    {
                        header: '단위',
                        name: 'matUnit'
                    },
                    {
                        header: '규격',
                        name: 'matStandard'
                    },
                    {
                        header: '총재고량',
                        name: 'matCount2'
                    },
//                     {
//                         header: '총재고량',
//                         name: 'matCount'
//                     },
                    {
                        header: '안전재고',
                        name: 'matSafeStock'
                    },
                ],
                rowHeaders: ['rowNum'],
                pageOptions: {
                    useClient: true,
                    perPage: 5
                }
            });
            
            
            let lotmat= {};
            
            matGrid.on('click', function (ev) {
                console.log('ev 이벤트 :', ev.columnName);
                let columnName = ev.columnName;
                if (columnName === 'matCode') {
                    let rowKey = ev.rowKey;
                    let rowData = matGrid.getRow(rowKey);
                    console.log("rowData : ", rowData.matCode);
					
                    lotmat.matLotCode = rowData.matLotCode;
                    console.log('lotmat.matLotCode '  , lotmat.matLotCode)
                    lotmat.matCount = rowData.matCount;
                    lotmat.matCode = rowData.matCode;
                    lotmat.matName = rowData.matName;
                    

                    if (rowData) {
                        let matCode = rowData.matCode;
                        fetch('/matLotList?matCode=' + matCode)
                        .then(response => response.json())
 	                    .then(data => {
								console.log("data : ", data);
 	                    		// 그리드 갱신
 	                    		lotGrid.resetData(data);

 	                    })
 	                    .catch(err => {
 	                        console.error('Error:', err);
 	                    });
 	        		}
 	    		}});
        	});

            let lotGrid = new tui.Grid({
                el: document.getElementById('lotGrid'),
                scrollX: false,
                scrollY: false,
                columns: [
                    {
                        header: '자재 LOT',
                        name: 'matLotCode'
                    },
                    {
                        header: '자재코드',
                        name: 'matCode'
                    },
                    {
                        header: '자재명',
                        name: 'matName'
                    },
                    {
                        header: '재고',
                        name: 'matInputCount'
                    },
                ],
                rowHeaders: ['rowNum'],
                pageOptions: {
                    useClient: true,
                    perPage: 5
                }
            });
            
            
            // 검색
            function searchFunction() {	
                 let input, filter, table, tr, td, i, j, txtValue;
         	     input = document.getElementById("searchOrder");
         	     filter = input.value.toUpperCase();
         	     table = document.getElementById("matGrid");

         	     tr = table.getElementsByTagName("tr");
         	     for (i = 0; i < tr.length; i++) {
         	         td = tr[i].getElementsByTagName("td");
         	         for (j = 0; j < td.length; j++) {
         	             txtValue = td[j].textContent || td[j].innerText;
         	             if (txtValue.toUpperCase().indexOf(filter) > -1) {
         	                 tr[i].style.display = "";
         	                 break;
         	             } else {
         	                 tr[i].style.display = "none";
         	             }
         	         }
         	     }
         	 }

            
      </script>
	</section>
</body>
</html>

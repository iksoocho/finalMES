<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8" />
<title>발주 관리 ^^</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<style>
button {
	float: right;
	margin-right: 5px;
	margin-bottom: 10px;
}
</style>
</head>
<body>
	<section layout:fragment="content">


		<div class="container">
			<!--  ================== 그리드 ================  -->
			<div class="row">
				<div class="col-8">
					<div id="matGrid" class="container">
						<h2>현재 자재 재고</h2>
					</div>
				</div>

				<div class="col-4">
					<div id="busiGrid" class="container">
						<h2>거래처 목록</h2>
					</div>

				</div>
			</div>
			
			
			
			
		
			<!-- ============================모달창============================ -->
			<div class="modal fade modal-xl" id="exampleModal" tabindex="-1"
				aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel">발주</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>

						<!-- ============================모달 내용============================ -->
						<div class="modal-body">
							<div>
								<h4>주문서</h4>
								<!-- <button class="btn btn-secondary" style="float: right; margin: 0 5px;">선택</button> -->
								<table class="table">
									<thead>
										<tr>
											<th></th>
											<th>거래처코드</th>
											<th>거래처명</th>
											<th>발주일자</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="matOrd : ${list}"
											th:data-ord-code="${matOrd.matCode}" class="ord-row">
											<td>
												<div class="form-check">
													<input class="form-check-input" type="radio"
														name="flexRadioDefault" th:id="${matOrd.matCode}" /> <label
														class="form-check-label" th:for="${matOrd.matCode}"></label>
												</div>
											</td>
											<td th:text="${matOrd.businessCode}"></td>
											<td th:text="${matOrd.businessName}"></td>
											<td
												th:text="${#dates.format(matOrd.matOrDate, 'yyyy-MM-dd')}"></td>
										</tr>
									</tbody>
								</table>
							</div>

							<div id="orderDetails"></div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary" id="addPlanBtn">
								추가</button>
						</div>
					</div>
				</div>
			</div>

			<button type="button" class="btn btn-primary">저장</button>
			<button type="button" class="btn btn-primary" data-bs-toggle="modal"
				data-bs-target="#exampleModal">조회</button>
			



		</div>

		<!-- 		<button class="btn btn-primary">등록</button> -->

		<!--  ============	모달창 ============-->
<!-- 		<div class="modal fade modal-xl" id="staticBackdrop" -->
<!-- 			data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" -->
<!-- 			aria-labelledby="staticBackdropLabel" aria-hidden="true"> -->
<!-- 			<div class="modal-dialog"> -->
<!-- 				<div class="modal-content"> -->
<!-- 					<div class="modal-header"> -->
<!-- 						<h1 class="modal-title fs-5" id="staticBackdropLabel">발주 등록</h1> -->
<!-- 						<button type="button" class="btn-close" data-bs-dismiss="modal" -->
<!-- 							aria-label="Close"></button> -->
<!-- 					</div> -->
<!-- 					<div class="modal-body"> -->
<!-- 							모달 내용 -->
<!-- 						<table> -->
<!-- 							<thead> -->
<!-- 								<tr> -->
<!-- 									<th>발주코드</th> -->
<!-- 									<th>거래처명</th> -->
<!-- 									<th>자재코드</th> -->
<!-- 									<th>자재명</th> -->
<!-- 								</tr> -->
<!-- 							</thead> -->
<!-- 							<tbody> -->
<!-- 								<tr th:each="mat : ${oList}" th:data-matCode="${mat.matCode}" -->
<!-- 									th:data-matName="${mat.matName}" -->
<!-- 									th:data-matUnit="${mat.matUnit}" -->
<!-- 									th:data-matStandard="${mat.matStandard}" -->
<!-- 									data-bs-dismiss="modal" -->
<!-- 									th:onclick="'displaySelectedMaterial(this)'"> -->
<!-- 									<td th:text="${mat.matCode}"></td> -->
<!-- 									<td th:text="${mat.matName}"></td> -->
<!-- 									<td th:text="${mat.matUnit}"></td> -->
<!-- 									<td th:text="${mat.matStandard}"></td> -->
<!-- 								</tr> -->
<!-- 							</tbody> -->
<!-- 						</table> -->
<!-- 					</div> -->
<!-- 					<div class="modal-footer"> -->
<!-- 						<button type="button" class="btn btn-secondary" -->
<!-- 							data-bs-dismiss="modal">닫기</button> -->
<!-- 						<button type="button" class="btn btn-primary" id="orderInsert"> -->
<!-- 							작성완료</button> -->
<!-- 					</div> -->
<!-- 				</div> -->
<!-- 			</div> -->
<!-- 		</div> -->

		<div class="container">
			<h2>발주목록</h2>

			<div id="ordGrid"></div>
		</div>




		<script th:inline="javascript">



                    // 그리드 행 추가 연습
//                       let order = [[${list}]]  // 쓸때 <div id="orderGrid"></div> 이거 정의해주세요 
//                     	 let orderGrid
//                     	 document.addEventListener('DOMContentLoaded', function(){
//                       			  orderGrid = new tui.Grid({
//                                   el: document.getElementById('orderGrid'),
//                                   data: order, // 여기서 emps 데이터를 사용
//                               // 그리드 컬럼설정
//                       	      columns: [
//                       	        {
//                       	          header: '발주코드',
//                       	          name: 'matOrCode'
//                       	        },
//                       	        {
//                       	          header: '자재코드',
//                       	          name: 'matCode'
//                       	        },
//                       	        {
//                       	          header: '발주명',
//                       	          name: 'matOrName',
//                       	          editor: 'text'
//                       	        },
//                       	        {
//                       		      header: '발주일',
//                       		      name: 'matOrDate',
//                       		      formatter : function dateFormatter(params) {
//                       		    	  const date = new Date(params.value);
//                       		    	  const isoDate = date.toISOString().split('T')[0];
//                       		    	  return isoDate;
//                       		    	}
//                       		    },
//                       		    {
//                       		      header: '담당자',
//                       		      name: 'matOrManager'
//                       		    },
//                       	      ],
//                       	      rowHeaders: ['rowNum'],
//                                   pageOptions: {
//                                       useClient: true,
//                                       perPage: 5,
//                                   }
//                       	    });


							
                      		
                      		let ordList = [[${list}]];
                      		ordGrid = new tui.Grid({
        						el: document.getElementById('ordGrid'),
        				        data : ordList,
        				        scrollX: false,
                                scrollY: false,
        				        columns: [
        						    // 데이터 구조에 따라 컬럼을 정의하세요
        						    { name: 'matOrCode', header: '발주코드' },
        						    { name: 'matOrName', header: '발주명' },
        						    { name: 'matCode', header: '자재코드' },
        						    { name: 'businessName', header: '거래처명' },

        						    { name: 'matOrCount', header: '발주량' },
        						    { name: 'matOrDate', header: '발주일' ,
            		  	            formatter: function({value}) {
            		  	                if (value) {
            		  	                    var date = new Date(value);
            		  	                    var year = date.getFullYear();
            		  	                    var month = (date.getMonth() + 1).toString().padStart(2, '0');
            		  	                    var day = date.getDate().toString().padStart(2, '0');
            		  	                    return `${year}-${month}-${day}`;
            		  	                }
            		  	                return '';
            		  	              }		
        						    },
        						    { name: 'matOrDueDate', header: '납기요청일' ,
        		  	                formatter: function({value}) {
        		  	                    if (value) {
        		  	                        var date = new Date(value);
        		  	                        var year = date.getFullYear();
        		  	                        var month = (date.getMonth() + 1).toString().padStart(2, '0');
        		  	                        var day = date.getDate().toString().padStart(2, '0');
        		  	                        return `${year}-${month}-${day}`;
        		  	                    }
        		  	                    return '';
        		  	                  }
        						    },
        						    {name: 'matOrManager', header: '담당자'},
                          		    {
                              		  header: '발주상태',
                              		  name: 'matOrState'
                              		}
        						    // 데이터에 따라 다른 컬럼 추가
        						  ],
        						  // 여기에 다른 그리드 옵션을 추가할 수 있습니다
        						  rowHeaders: ['rowNum','checkbox'],
        			            	pageOptions: {
        			                useClient: true,
        			                perPage: 5
        			            	}
        						  });



        					  // 현재 자재 재고
        					let mat = [[${oList}]];
							let matGrid, busiGrid;
							class NumberEditor{
								constructor(props){
									const el = document.createElement('input');
									el.type = 'number';
							      	el.value = String(props.value);
							      	el.min = props.columnInfo.editor.options.min;
							      	el.step = props.columnInfo.editor.options.step;
									
									this.el = el;
								}
								
								getElement(){
									return this.el;
								}
								
								getValue(){
									return this.el.value;
								}
								
								mounted(){
									this.el.select();
								}
							};
							document.addEventListener('DOMContentLoaded', function() {
							 	 matGrid = new tui.Grid({
                                 el: document.getElementById('matGrid'),
                                 data: mat, // 여기서 emps 데이터를 사용
                      	      	columns: [
	                      	        {
	                      	          header: '자재코드',
	                      	          name: 'matCode'
	                      	        },
	                      	        {
                      	          	  header: '자재명',
                      	          	  name: 'matName'
                      	        	},
                      	        	{
                      	          	  header: '단위',
                      	          	  name: 'matUnit'
                      	        	},
                      	        	{
                      	          	  header: '규격',
                      	          	  name: 'matStandard'
                      	        	},
                      	        	{
                      	          	  header: '현재고',
                      	          	  name: 'matCount'
                      	        	},
                      	        	{
                      		      	  header: '안전재고',
                      		      	  name: 'matSafeStock'
                      		    	},
        	//               		{
            //               		  header: '소모예정량',
        	//              	      name: ''
        	//               		},
                      	      	],
                      	      	rowHeaders: ['rowNum'],
								pageOptions: {
                                    useClient: true,
                                    perPage: 5
                                }
                      	});
							 	 
        					  
        					  
        				matGrid.on('click', function(ev) {
              				console.log(ev.columnName);
             				  var columnName = ev.columnName;
                 	    	  if (columnName === 'matCode') {
                 	          var rowKey = ev.rowKey;
                 	          var rowData = matGrid.getRow(rowKey);
 							  
                 	          if (rowData) {
                 	              var matCode = rowData.matCode;
								console.log("맷코드 입니다 :", matCode);
                   	             // planCode를 사용하여 상세 데이터 요청
                  	             fetch('/matDetail?matCode=' + matCode)
                  	                 .then(response => response.json())
                  	                 .then(data => {
                  	                	 console.log(data);
                  	                     // 상세 그리드에 데이터 표시
                  	                     // grid는 상세 계획을 표시하는 Toast Grid의 인스턴스를 나타냅니다.
                  					 busiGrid.resetData(data);
                  	                 })
                  	                 .catch(error => {
                  	                     console.error('Error:', error);
                  	                 });
                  	        	 }
                  	    	  }
                    	});

                      	  busiGrid = new tui.Grid({
                            el: document.getElementById('busiGrid'),
                            scrollX: false,
                            scrollY: false,
                	      columns: [
                	        {
                	          header: '거래처코드',
                	          name: 'businessCode'
                	        },
                	        {
                	          header: '거래처명',
                	          name: 'businessName'
                	        },
                	        {
                	          header: '거래횟수',
                	          name: 'deal'
                	        }
                	      ],
                	      rowHeaders: ['rowNum'],
                            pageOptions: {
                                useClient: true,
                                perPage: 5
                            }
                	    });
                      	  
                     console.log("matGrid", matGrid);
                     
			});
							

// 			// 이거 내 발주목록 그리드 클릭이벤트
// 			busiGrid.on('click', function(ev) {
// 				console.log("ev클릭이벤트 : " , ev.columnName);
// 				let columnName = ev.columnName;
// 				if(columnName === '내컬럼'){
// 					let rowKey = ev.rowKey;
// 					let rowData = 내컬럼.getRow(rowKey);

// 					if(rowData){
// 						let 내컬럼 = rowData.내컬럼;
// 						console.log("내컬럼", 내컬럼);

// 						fetch('/내 컨트롤 경로' + 내컬럼)
// 							.then(response => response.json())
// 							.then(data => {
// 								console.log(data);

// 								하나더만들그리드.resetData(data);
// 							})
// 							.catch(err => {
// 								console.log('Error:', error);
// 							});
// 					}
// 				}
// 			});

// 			하나더만들그리드 = new tui.Grid({
// 				el: document.getElementById('하나더만들그리드'),
// 				scrollX:false
// 			})


			
      </script>



	</section>
</body>
</html>

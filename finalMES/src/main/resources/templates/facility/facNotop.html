<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<title>ì„¤ë¹„ë¹„ê°€ë™ë“±ë¡</title>
<style>
#layoutSidenav_content {
	margin-top: 20px;
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-bottom: 20px;
}

input[type="text"], input[type="date"] {
	width: 200px;
	box-sizing: border-box;
}

label {
	display: block;
	margin-bottom: 5px;
}

input[type="checkbox"] {
	margin-right: 5px;
}

button {
	margin-right: 5px;
}

#myModal3 {
	text-align: center;
}
</style>
</head>
<body>

	<section layout:fragment="content">
		<h1>ì„¤ë¹„ë¹„ê°€ë™ê´€ë¦¬</h1>
		<div class="container">
			<div class="col">
				<br> <br>
				<table class="table">
					<thead>
						<tr>
							<th>ë¹„ê°€ë™ì½”ë“œ</th>
							<td colspan="2"><input type="text" id="facNotCode"
								name="facNotCode" required readonly></td>
							<th>ì„¤ë¹„ëª…</th>
							<td colspan="2"><input type="text" id="facName"
								name="facName" required></td>
							<th>ì‚¬ìœ </th>
							<td colspan="2"><input type="text" id="facNotReason"
								name="facNotReason" th:data-notopCode="${notopCode}" required></td>
						<tr>
							
							<th>ë‹´ë‹¹ì</th>
							<td colspan="2"><input type="text" id="facNotPerson"
								name="facNotPerson" th:value="${username}" required></td>
							<th>ì‹œì‘ì¼</th>
							<td colspan="2"><input type="date" id="facNotSdate"
								name="facNotSdate" required></td>
							<th>ì¢…ë£Œì¼</th>
							<td colspan="2"><input type="date" id="facNotLdate"
								name="facNotLdate" required></td>
						<tr>
							<td colspan="2"><input type="text" id="facCode"
								name="facCode" required style="display: none;"></td>
							<th>ì„¤ë¹„ìƒíƒœ</th>
							<td><select id="facNotSituation" name="facNotSituation">
									<option value="0">ëŒ€ê¸°</option>
									<option value="1">ê°€ë™</option>
									<option value="2">ë¹„ê°€ë™</option>
							</select></td>
						</tr>
						<tr>
					</thead>
				</table>
				<div class="text-center">
				<button type="button" id="saveBtn" class="btn btn-outline-success">ì €ì¥</button>
				<button type="button" class="btn btn-outline-primary" onclick="downloadCSV()">ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</button>
				<input type="text" id="searchInput" oninput="searchFunction()" placeholder="ê²€ìƒ‰...">
				</div>
				<br> <br> <br>
				<div id="grid" class="container"></div>
			</div>
			</div>

		<script th:inline="javascript">
  
   		document.getElementById('saveBtn').addEventListener("click", function() {
          
   		var facCode = document.getElementsByName("facCode")[0].value;
   		var facNotCode = document.getElementsByName("facNotCode")[0].value;
        var facName = document.getElementsByName("facName")[0].value;
        var facNotPerson = document.getElementsByName("facNotPerson")[0].value;
        var facNotReason = document.getElementsByName("facNotReason")[0].value;
        var facNotSituation = document.getElementsByName("facNotSituation")[0].value;
        var facNotSdate = document.getElementsByName("facNotSdate")[0].value;
        var facNotLdate = document.getElementsByName("facNotLdate")[0].value;
        
        if (!facName) {
              alert("ì„¤ë¹„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return;
          }
        
        
               var data = {
            	  facCode: facCode,
            	  facNotCode: facNotCode,
                  facName: facName,
                  facNotPerson: facNotPerson,
                  facNotReason: facNotReason,
                  facNotSituation: facNotSituation,
                  facNotSdate: facNotSdate,
                  facNotLdate: facNotLdate
               };
               
               fetch("/updateFacNot", {
                 method: "PUT",
                 body: JSON.stringify(data),
                 headers: {
                     "Content-Type": "application/json"
                 }
             })
             .then(response => {
                console.log(response.status);
                 if (response.ok) {
                     console.log(response);
                     alert("ë“±ë¡ì™„ë£Œ!");
                     location.href = '/facNotop';  // ì—¬ê¸° ê²½ë¡œë¡œ ê°€ë¼
                 } else {
                     console.log(response);
                     alert("ë“±ë¡ì‹¤íŒ¨");
                 }
             })
             .catch(error => {
                 console.log(error);
                 alert(ì˜¤ë¥˜);
             });
         });
   		
   		// ì—‘ì…€ë‹¤ìš´ë¡œë“œ
   		function downloadCSV() {
        const gridData = grid.getData(); // ê·¸ë¦¬ë“œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const header = Object.keys(gridData[0]).join(','); // í—¤ë” ìƒì„±
        const csv = gridData.map(row => Object.values(row).join(',')).join('\n'); // ë°ì´í„° ìƒì„±

        const csvContent = `data:text/csv;charset=utf-8,${header}\n${csv}`; // CSV ë‚´ìš© ìƒì„±
        const encodedUri = encodeURI(csvContent); // URI ì¸ì½”ë”©

        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'data.csv');
        document.body.appendChild(link);
        link.click();
    }
   		
   		
   
   
   	 // ê·¸ë¦¬ë“œ í˜ì´ì§•
   	    let facNotList = [[${nlist}]];
   	 	console.log(facNotList);
   	    const grid = new tui.Grid({
   	      el: document.getElementById('grid'),
   	      data: facNotList,
   	      scrollX: false,
   	      scrollY: false,
   	      columns: [
   	    	{
      	      header: 'ë¹„ê°€ë™ì½”ë“œ',
      	      name: 'facNotCode',
      	      align: 'center',
      	    },
   	        {
   	          header: 'ì„¤ë¹„ì½”ë“œ',
   	          name: 'facCode',
   	          align: 'center',
   	        },
   	        {
   	          header: 'ë¹„ê°€ë™ë“±ë¡ì‚¬ìœ ',
   	          name: 'facNotReason',
   	          align: 'center'
   	        },
   	        {
   	          header: 'ì„¤ë¹„ëª…',
   	          name: 'facName',
   	          align: 'center'
   	        },
   	        {
   	          header: 'ë‹´ë‹¹ì',
   	          name: 'facNotPerson',
   	          align: 'center'
   	        },
   	        {
   	          header: 'ìƒíƒœ',
   	          name: 'facNotSituation',
   	          formatter: function(value) {
   	            var numericValue = +value.value;

   	            if (numericValue === 0) {
   	              return 'ğŸŸ¡';
   	            } else if (numericValue === 1) {
   	              return 'ğŸŸ¢';
   	            } else if (numericValue === 2) {
   	              return 'ğŸ”´';
   	            } else {
   	              return 'ì•Œ ìˆ˜ ì—†ëŠ” ìƒíƒœ';
   	            }
   	          },
   	          align: 'center'
   	        }
   	      ],
   	      rowHeaders: ['rowNum'],
   	      pageOptions: {
   	        useClient: true,
   	        perPage: 5
   	      }
   	    });

   	    // ì„¤ë¹„ì½”ë“œ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬í•´ì„œ ìœ„ì— inputë°•ìŠ¤ì— ê°’ë„£ê¸°
   	   function handleFacCodeClick(event) {
   	      // í´ë¦­í•œ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
   	   const rowData = grid.getRowAt(event.rowKey);

   	      // ì„¤ë¹„ëª…ê³¼ ë‹´ë‹¹ì ê°’ì„ ê°€ì ¸ì™€ì„œ input ë°•ìŠ¤ì— ë„£ê¸°
   	   const facName = rowData.facName;
   	   const facNotPerson = rowData.facNotPerson;
   	   const facNotCode = rowData.facNotCode;
   	   const facCode = rowData.facCode;
   	   const facNotSdate = rowData.facNotSdate;
   	   const facNotLdate = rowData.facNotLdate;
   	   
   	   document.getElementById('facNotCode').value = facNotCode;
   	   document.getElementById('facCode').value = facCode;
   	   document.getElementById('facName').value = facName;
   	   document.getElementById('facNotPerson').value = facNotPerson;
   	   document.getElementById('facNotSdate').value = facNotSdate;
   	   document.getElementById('facNotLdate').value = facNotLdate;
   	    }

   	    // grid ìƒì„± ì½”ë“œ ì•„ë˜ì— ì„¤ë¹„ì½”ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
   	    grid.on('click', (event) => {
   	      if (event.columnName === 'facCode') {
   	        handleFacCodeClick(event);
   	      }
   	    });
   	    
   	// ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
   	 function searchFunction() {
   	     var input, filter, table, tr, td, i, j, txtValue;
   	     input = document.getElementById("searchInput");
   	     filter = input.value.toUpperCase();
   	     table = document.getElementById("grid");

   	     tr = table.getElementsByTagName("tr");
   	     for (i = 0; i < tr.length; i++) {
   	         td = tr[i].getElementsByTagName("td");
   	         for (j = 0; j < td.length; j++) {
   	             txtValue = td[j].textContent || td[j].innerText;
   	             if (txtValue.toUpperCase().indexOf(filter) > -1) {
   	                 tr[i].style.display = "";
   	                 break;
   	             } else {
   	                 tr[i].style.display = "none";
   	             }
   	         }
   	     }
   	 }

   	






</script>
	</section>
</body>
</html>
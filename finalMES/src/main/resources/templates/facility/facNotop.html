<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script
	src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
<title>ì„¤ë¹„ë¹„ê°€ë™ë“±ë¡</title>
<style>
#layoutSidenav_content {
	margin-top: 20px;
}

table {
	width: 100%;
	border-collapse: collapse;
	margin-bottom: 20px;
}

input[type="text"], input[type="date"] {
	width: 200px;
	box-sizing: border-box;
}

label {
	display: block;
	margin-bottom: 5px;
}

input[type="checkbox"] {
	margin-right: 5px;
}

button {
	margin-right: 5px;
}

#myModal3 {
	text-align: center;
}
body {
    font-family: Arial, sans-serif; /* ì „ì²´ í˜ì´ì§€ì— ëŒ€í•œ ê¸°ë³¸ ê¸€ê¼´ ì„¤ì • */
    background-color: #f8f9fa; /* í˜ì´ì§€ ë°°ê²½ìƒ‰ ì„¤ì • */
}

.container {
    margin: auto; /* ì»¨í…Œì´ë„ˆë¥¼ ìˆ˜í‰ ê°€ìš´ë° ì •ë ¬ */
    padding: 20px;
    background-color: #ffffff; /* ì»¨í…Œì´ë„ˆ ë°°ê²½ìƒ‰ ì„¤ì • */
    border-radius: 10px; /* ì»¨í…Œì´ë„ˆì— ë¼ìš´ë“œ ëª¨ì„œë¦¬ ì„¤ì • */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ ì¶”ê°€ */
}

h1 {
    text-align: center; /* ì œëª© ê°€ìš´ë° ì •ë ¬ */
}

.btn {
    margin-right: 5px; /* ë²„íŠ¼ ê°„ê²© ì„¤ì • */
}

input[type="text"], input[type="date"] {
    width: 100%; /* ì…ë ¥ë€ ì „ì²´ ë„ˆë¹„ë¡œ ì„¤ì • */
    padding: 8px; /* ë‚´ë¶€ ì—¬ë°± ì¶”ê°€ */
    border-radius: 5px; /* ì…ë ¥ë€ì— ë¼ìš´ë“œ ëª¨ì„œë¦¬ ì„¤ì • */
    border: 1px solid #ced4da; /* ì…ë ¥ë€ í…Œë‘ë¦¬ ì„¤ì • */
}

/* ê²€ìƒ‰ ì…ë ¥ë€ ìŠ¤íƒ€ì¼ */
#searchInput {
    margin-top: 10px; /* ê²€ìƒ‰ ì…ë ¥ë€ê³¼ ë²„íŠ¼ ì‚¬ì´ì˜ ê°„ê²© ì„¤ì • */
    width: 200px; /* ë„ˆë¹„ë¥¼ ì‘ê²Œ ì¡°ì • */
    padding: 8px; /* ë‚´ë¶€ ì—¬ë°± ì¶”ê°€ */
    border-radius: 5px; /* ì…ë ¥ë€ì— ë¼ìš´ë“œ ëª¨ì„œë¦¬ ì„¤ì • */
    border: 1px solid #ced4da; /* ì…ë ¥ë€ í…Œë‘ë¦¬ ì„¤ì • */
}

/* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.modal-content {
    border-radius: 10px; /* ëª¨ë‹¬ì— ë¼ìš´ë“œ ëª¨ì„œë¦¬ ì„¤ì • */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); /* ê·¸ë¦¼ì íš¨ê³¼ ì¶”ê°€ */
}

.modal-header {
    background-color: #007bff; /* ëª¨ë‹¬ í—¤ë” ë°°ê²½ìƒ‰ ì„¤ì • */
    color: white; /* ëª¨ë‹¬ í—¤ë” ê¸€ììƒ‰ ì„¤ì • */
    border-radius: 10px 10px 0 0; /* ëª¨ë‹¬ í—¤ë”ì— ë¼ìš´ë“œ ëª¨ì„œë¦¬ ì„¤ì • */
}

.modal-footer {
    background-color: #f8f9fa; /* ëª¨ë‹¬ í‘¸í„° ë°°ê²½ìƒ‰ ì„¤ì • */
    border-top: none; /* ëª¨ë‹¬ í‘¸í„°ì— í…Œë‘ë¦¬ ì—†ì• ê¸° */
    border-radius: 0 0 10px 10px; /* ëª¨ë‹¬ í‘¸í„°ì— ë¼ìš´ë“œ ëª¨ì„œë¦¬ ì„¤ì • */
}
.modal-title {
    font-size: 24px; /* ê¸°ì¡´ í¬ê¸° ìœ ì§€ */
    font-weight: bold; /* ì§„í•˜ê²Œ í‘œì‹œ */
    color: black; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ë³€ê²½ */
}
/* select ìš”ì†Œì˜ ì „ì²´ ìŠ¤íƒ€ì¼ */
select {
    width: 100%; /* ë„ˆë¹„ ì„¤ì • */
    padding: 8px; /* ë‚´ë¶€ ì—¬ë°± ì¶”ê°€ */
    border-radius: 5px; /* ë¼ìš´ë“œ ëª¨ì„œë¦¬ ì„¤ì • */
    border: 1px solid #ced4da; /* í…Œë‘ë¦¬ ì„¤ì • */
    background-color: #fff; /* ë°°ê²½ìƒ‰ ì„¤ì • */
    font-size: 16px; /* í°íŠ¸ í¬ê¸° ì„¤ì • */
    color: #495057; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì„¤ì • */
}

/* select ìš”ì†Œì˜ í™œì„±í™” ìƒíƒœ ìŠ¤íƒ€ì¼ */
select:focus {
    outline: none; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ì œê±° */
    border-color: #80bdff; /* í¬ì»¤ìŠ¤ ì‹œ í…Œë‘ë¦¬ ìƒ‰ìƒ ë³€ê²½ */
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25); /* í¬ì»¤ìŠ¤ ì‹œ ê·¸ë¦¼ì íš¨ê³¼ ì¶”ê°€ */
}

/* select ìš”ì†Œì˜ ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
select::-ms-expand {
    display: none; /* IEì—ì„œ ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ ì•„ì´ì½˜ ìˆ¨ê¹€ */
}

/* select ìš”ì†Œì˜ ë“œë¡­ë‹¤ìš´ í™”ì‚´í‘œ ìŠ¤íƒ€ì¼ */
.select-arrow {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none; /* ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ ë°©ì§€ */
}

/* ì„ íƒëœ ì˜µì…˜ì˜ ìŠ¤íƒ€ì¼ */
option:checked {
    background-color: #007bff; /* ì„ íƒëœ ì˜µì…˜ì˜ ë°°ê²½ìƒ‰ */
    color: #fff; /* ì„ íƒëœ ì˜µì…˜ì˜ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
}


</style>
</head>
<body>

	<section layout:fragment="content">
		<div class="container">
		<h1>ì„¤ë¹„ë¹„ê°€ë™ê´€ë¦¬</h1>
			<div class="col">
				<br> <br>
				<table class="table">
					<thead>
						<tr>
							<th>ë¹„ê°€ë™ì½”ë“œ</th>
							<td colspan="2"><input type="text" id="facNotCode"
								name="facNotCode" required readonly></td>
							<th>ì„¤ë¹„ëª…</th>
							<td colspan="2"><input type="text" id="facName"
								name="facName" required></td>
							<th>ì‚¬ìœ </th>
							<td colspan="2"><input type="text" id="facNotReason"
								name="facNotReason" th:data-notopCode="${notopCode}" required></td>
						<tr>
							
							<th>ë‹´ë‹¹ì</th>
							<td colspan="2"><input type="text" id="facPerson"
								name="facPerson" th:value="${username}" required></td>
							<th>ì‹œì‘ì¼</th>
							<td colspan="2"><input type="date" id="facNotSdate"
								name="facNotSdate" required></td>
							<th>ì¢…ë£Œì¼</th>
							<td colspan="2"><input type="date" id="facNotLdate"
								name="facNotLdate" required></td>
						<tr>
						<th>ì„¤ë¹„ìƒíƒœ</th>
							<td>
								<select id="facNotSituation" name="facNotSituation">
										<option value="f1">ëŒ€ê¸°</option>
										<option value="f2">ê°€ë™</option>
										<option value="f3">ë¹„ê°€ë™</option>
								</select>
							</td>
							<td colspan="2"><input type="text" id="facCode"
								name="facCode" required style="display: none;"></td>
							
						</tr>
						<tr>
					</thead>
				</table>
				<div class="text-center">
				<button type="button" id="saveBtn" class="btn btn-outline-success">ì €ì¥</button>
				<button type="button" class="btn btn-outline-primary" onclick="downloadCSV()">Excel</button>
				<input type="text" id="searchInput" oninput="searchFunction()" placeholder="ê²€ìƒ‰...">
				</div>
				<br> <br> <br>
				<div id="grid" class="container"></div>
			</div>
			</div>

		<script th:inline="javascript">
		
		
		function getOutStatus(value, row) {
			console.log(value.value); // ê°’ í™•ì¸ìš© ë¡œê·¸
			let statusText, bgColor;

			// ì£¼ë¬¸ ìƒíƒœì— ë”°ë¼ ì›í•˜ëŠ” ë¬¸ìì—´ê³¼ ë°°ê²½ìƒ‰ ì„¤ì •
			switch (value.value) {
				case "ê°€ë™ëŒ€ê¸°":
					statusText = 'ğŸŸ¡';
					
					break;
				case "ê°€ë™ì¤‘":
					statusText = 'ğŸŸ¢';
					
					break;
				case "ë¹„ê°€ë™":
					statusText = 'ğŸ”´';
					
					break;
				case "":
				case undefined:
				case null:
					statusText = 'ì•Œìˆ˜ ì—†ëŠ” ìƒíƒœ';
					bgColor = 'red'; // ê³„íš ì§„í–‰ì¤‘ì— ëŒ€í•œ ë°°ê²½ìƒ‰ ì„¤ì •
					break;

			}
			return `<div>${statusText}</div>`;
		};
		
  		// saveBtn ë²„íŠ¼ì— ì´ë²¤íŠ¸ ê±¸ì–´ì„œ í´ë¦­ ì‹œ í•¨ìˆ˜ ì‹¤í–‰
   		document.getElementById('saveBtn').addEventListener("click", function() {
        // ì…ë ¥í•„ë“œì˜ name ê°’ ë°›ì•„ì™€ì„œ ë³€ìˆ˜ì— í• ë‹¹í•¨
   		var facCode = document.getElementsByName("facCode")[0].value;
   		var facNotCode = document.getElementsByName("facNotCode")[0].value;
        var facName = document.getElementsByName("facName")[0].value;
        var facPerson = document.getElementsByName("facPerson")[0].value;
        var facNotReason = document.getElementsByName("facNotReason")[0].value;
        var facNotSituation = document.getElementsByName("facNotSituation")[0].value;
        var facNotSdate = document.getElementsByName("facNotSdate")[0].value;
        var facNotLdate = document.getElementsByName("facNotLdate")[0].value;
        
        
        if (!facName || !facNotReason) {
        	Swal.fire({
            icon: 'error',
            text: 'ì„¤ë¹„ëª…ê³¼ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'
        });
        return;
    	}
        
        if (!facPerson) {
        	Swal.fire({
            icon: 'error',
            text: 'ë‹´ë‹¹ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'
        });
        return;
    	}
        
        	   // ë“±ë¡ í•  ê°’ ê°ì²´ë¡œ 
               var data = {
            	  facCode: facCode,
            	  facNotCode: facNotCode,
                  facName: facName,
                  facPerson: facPerson,
                  facNotReason: facNotReason,
                  facNotSituation: facNotSituation,
                  facNotSdate: facNotSdate,
                  facNotLdate: facNotLdate
               };
               // fetchë¡œ ì„œë²„ì— PUT ìš”ì²­
               fetch("/updateFacNot", {
                 method: "PUT",
                 body: JSON.stringify(data), // JSON í˜•ì‹ì˜ ë°ì´í„°ë¥¼ ì „ì†¡
                 headers: {
                     "Content-Type": "application/json"  // JSON í˜•ì‹ì˜ ë°ì´í„°ì„ì„ ëª…ì‹œ
                 }
             })
             .then(response => {
                console.log(response.status);
                 if (response.ok) {
                     console.log(response);
                     Swal.fire({
 		                icon: 'success',
 		                text: 'ì €ì¥ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!'
 		            }).then(() => {
 		                location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
 		            });  
                 } else {
                     console.log(response);
                     alert("ë“±ë¡ì‹¤íŒ¨");
                 }
             })
             .catch(error => {
                 console.log(error);
                 alert(ì˜¤ë¥˜);
             });
         });
   		
   	//  ì°¨ê¸°ì ê²€ì„ ë‚ ì§œí¬ë§·
        function formatDate(dateString) {
   		if(dateString.value == null) {
   			return '';
   		}
            // dateStringì„ Date ê°ì²´ë¡œ íŒŒì‹±
            const date = new Date(dateString.value);
            // ë‚ ì§œ í¬ë§· ë³€ê²½
            const formattedDate = date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).slice(-2) + '-' + ('0' + date.getDate()).slice(-2);
            return formattedDate;
        } 
   	
   	/* 	// ì—‘ì…€ë‹¤ìš´ë¡œë“œ
   		function downloadCSV() {
        const gridData = grid.getData(); // ê·¸ë¦¬ë“œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const header = Object.keys(gridData[0]).join(','); // í—¤ë” ìƒì„±
        const csv = gridData.map(row => Object.values(row).join(',')).join('\n'); // ë°ì´í„° ìƒì„±

        const csvContent = `data:text/csv;charset=utf-8,${header}\n${csv}`; // CSV ë‚´ìš© ìƒì„±
        const encodedUri = encodeURI(csvContent); // URI ì¸ì½”ë”©

        const link = document.createElement('a');
        link.setAttribute('href', encodedUri);
        link.setAttribute('download', 'data.csv');
        document.body.appendChild(link);
        link.click();
    } */
    
 


   		
   		
   
   
   	 // ê·¸ë¦¬ë“œ í˜ì´ì§•
   	    let facNotList = [[${nlist}]];
   	 	console.log("facNotList ",facNotList);
   	    const grid = new tui.Grid({
   	      el: document.getElementById('grid'),
   	      data: facNotList,
   	      scrollX: false,
   	      scrollY: false,
   	      columns: [
   	    	{
      	      header: 'ë¹„ê°€ë™ì½”ë“œ',
      	      name: 'facNotCode',
      	      align: 'center',
      	    },
   	        {
   	          header: 'ì„¤ë¹„ì½”ë“œ',
   	          name: 'facCode',
   	          align: 'center',
   	        },
   	        {
   	          header: 'ë¹„ê°€ë™ë“±ë¡ì‚¬ìœ ',
   	          width: 200,
   	          name: 'facNotReason',
   	          align: 'center'
   	        },
   	        {
   	          header: 'ì„¤ë¹„ëª…',
   	          name: 'facName',
   	          align: 'center'
   	        },
   	        {
   	          header: 'ë‹´ë‹¹ì',
   	          name: 'facPerson',
   	          align: 'center'
   	        },
   	     	{
              header: 'ë“±ë¡ì¼',
              name: 'facNotSdate',
              formatter : formatDate,
              align: 'center'
             },
   	     	{
              header: 'ì¢…ë£Œì¼',
              name: 'facNotLdate',
              formatter : formatDate,
              align: 'center'
            },
   	        {
   	          header: 'ìƒíƒœ',
   	          name: 'facNotSituation',
   	          formatter: getOutStatus,
   	          align: 'center'
   	        }
   	      ],
   	      rowHeaders: ['rowNum'],
   	      pageOptions: {
   	        useClient: true,
   	        perPage: 5
   	      }
   	    });
   	    
   	 function downloadCSV() {
         // í—¤ë” ìƒì„±
         const header = [
             'ë¹„ê°€ë™ì½”ë“œ',
             'ì„¤ë¹„ì½”ë“œ',
             'ë¹„ê°€ë™ë“±ë¡ì‚¬ìœ ',
             'ì„¤ë¹„ëª…',
             'ë‹´ë‹¹ì',
             'ìƒíƒœ',
         ];

         const gridData = grid.getData(); // ê·¸ë¦¬ë“œì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

         const csvRows = [header.join(',')]; // í—¤ë”ë¥¼ CSV í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì²« ë²ˆì§¸ í–‰ìœ¼ë¡œ ì„¤ì •

         // ë°ì´í„° ìƒì„±
         gridData.forEach(row => {
             const formattedRow = [
                 row.facNotCode,
                 row.facCode,
                 row.facNotReason,
                 row.facName,
                 row.facPerson,
                 row.facNotSituation
             ];
             csvRows.push(formattedRow.join(','));
         });

         // CSV ë‚´ìš© ìƒì„±
         const csvContent = 'data:text/csv;charset=utf-8,' + csvRows.join('\n');
         const encodedUri = encodeURI(csvContent); // URI ì¸ì½”ë”©

         // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± ë° í´ë¦­
         const link = document.createElement('a');
         link.setAttribute('href', encodedUri);
         link.setAttribute('download', 'data.csv');
         document.body.appendChild(link);
         link.click();
     }

   	    // ì„¤ë¹„ì½”ë“œ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬í•´ì„œ ìœ„ì— inputë°•ìŠ¤ì— ê°’ë„£ê¸°
		function handleFacCodeClick(event) {
    		// í´ë¦­í•œ í–‰ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
		    const rowData = grid.getRowAt(event.rowKey);
		
		    // ì„¤ë¹„ëª…ê³¼ ë‹´ë‹¹ì ê°’ì„ ê°€ì ¸ì™€ì„œ input ë°•ìŠ¤ì— ë„£ê¸°
		    const facName = rowData.facName;
		    const facPerson = rowData.facPerson;
		    const facNotCode = rowData.facNotCode;
		    const facCode = rowData.facCode;
		    const facNotSdate = rowData.facNotSdate;
		    const facNotLdate = rowData.facNotLdate;
		
		    // ê°’ì„ input ìš”ì†Œì— í• ë‹¹
		    document.getElementById('facNotCode').value = facNotCode;
		    document.getElementById('facCode').value = facCode;
		    document.getElementById('facName').value = facName;
		    document.getElementById('facPerson').value = facPerson;
		    document.getElementById('facNotSdate').value = facNotSdate;
		    document.getElementById('facNotLdate').value = facNotLdate;
		}

   	    // grid ìƒì„± ì½”ë“œ ì•„ë˜ì— ì„¤ë¹„ì½”ë“œ í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
   	    grid.on('click', (event) => {
   	      if (event.columnName === 'facCode') {
   	        handleFacCodeClick(event);
   	      }
   	    });
   	    
      	// ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
   		function searchFunction() {
   		    // ì…ë ¥ëœ ê²€ìƒ‰ì–´ ê°€ì ¸ì˜¤ê¸°
   		    var input, filter, table, tr, td, i, j, txtValue;
   		    input = document.getElementById("searchInput");
   		    // ëŒ€ë¬¸ìë¡œë³€í™˜í•˜ê¸°
   		    filter = input.value.toUpperCase();
   		    // í…Œì´ë¸” í™•ì¸
   		    table = document.getElementById("grid");

   		    // í…Œì´ë¸” ëŒë©´ì„œ í™•ì¸
   		    tr = table.getElementsByTagName("tr");
   		    for (i = 0; i < tr.length; i++) {
   		        // ê° í–‰ì—ì„œ ì…€ì„ ê°€ì ¸ì˜¤ê¸°
   		        td = tr[i].getElementsByTagName("td");
   		        // í–‰ì˜ ê° ì…€ ëŒë©´ì„œ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
   		        for (j = 0; j < td.length; j++) {
   		            // ì…€ì˜ ë‚´ìš©ì„ ê°€ì ¸ì˜¤ê¸°
   		            txtValue = td[j].textContent || td[j].innerText;
   		            // ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰ì–´ ìˆìœ¼ë©´ ê°€ì ¸ì˜¤ê¸°
   		            if (txtValue.toUpperCase().indexOf(filter) > -1) {
   		                tr[i].style.display = "";
   		                break;
   		            } else {
   		                // ê²€ìƒ‰ì–´ ì—†ìœ¼ë©´ ë¦¬ìŠ¤íŠ¸ ì•ˆë³´ì´ê²Œ display none ì²˜ë¦¬
   		                tr[i].style.display = "none";
   		            }
   		        }
   		    }
   		}

</script>
	</section>
</body>
</html>
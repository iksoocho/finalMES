<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
   xmlns:th="http://www.thymeleaf.org" layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<link rel="stylesheet"
   href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script
   src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.7/dist/umd/popper.min.js"></script>
<script
   src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<title>ì„¤ë¹„ë“±ë¡</title>
<style>
#layoutSidenav_content {
   margin-top: 20px;
}

table {
   width: 100%;
   border-collapse: collapse;
   margin-bottom: 20px;
}

input[type="text"], input[type="date"] {
   width: 200px;
   box-sizing: border-box;
}

label {
   display: block;
   margin-bottom: 5px;
}

input[type="checkbox"] {
   margin-right: 5px;
}

button {
   margin-right: 5px;
}

#myModal3 {
   text-align: center;
}
</style>
</head>
<body>

   <section layout:fragment="content">
      <h1>ì„¤ë¹„ë¹„ê°€ë™ê´€ë¦¬</h1>

      <div id="layoutSidenav_content" class="container text-center">

         <div class="col">
            <br> <br>
            <table class="table">
               <thead>
                  <tr>
                     <th>ì„¤ë¹„ëª… *</th>
                     <td colspan="2"><input type="text" id="facName"
                        name="facName" required data-toggle="modal"
                        data-target="#myModal"></td>
                     <th>ë‹´ë‹¹ì</th>
                     <td colspan="2"><input type="text" id="facNotPerson"
                        name="facNotPerson" required></td>
                  <tr>
                     <th>ì‚¬ìœ </th>
                     <td colspan="2"><input type="text" id="facNotReason"
                        name="facNotReason" required></td>
                     <th>ì„¤ë¹„ìƒíƒœ</th>
                     <td><select id="facNotSituation" name="facNotSituation">
                           <option value="0">ëŒ€ê¸°</option>
                           <option value="1">ê°€ë™</option>
                           <option value="2">ë¹„ê°€ë™</option>
                     </select></td>
                  <tr>
                     <th>ì‹œì‘ì¼</th>
                     <td colspan="2"><input type="date" id="facNotSdate"
                        name="facNotSdate" required></td>
                     <th>ì¢…ë£Œì¼</th>
                     <td colspan="2"><input type="date" id="facNotLdate"
                        name="facNotLdate" required></td>
                  </tr>
                  <tr>
               </thead>
            </table>
            <button type="button" id="saveBtn" class="btn btn-outline-success">ì €ì¥</button>
            <br>
            <br>
            <br>
            <div id="grid" class="container"></div>
         </div>
      </div>



      <!-- ì„¤ë¹„ì½”ë“œ ëª¨ë‹¬ì°½ -->
      <div class="modal" id="myModal">
         <div class="modal-dialog">
            <div class="modal-content">
               <!-- ëª¨ë‹¬ í—¤ë” -->
               <div class="modal-header">
                  <h4 class="modal-title">ì„¤ë¹„ëª…</h4>
                  <button type="button" class="close" data-dismiss="modal">&times;</button>
               </div>
               <div class="modal-body">
                  <!-- ëª¨ë‹¬ ë‚´ìš© ë°ì´í„°ë¡œ ë°›ì•„ì™€ì•¼í•¨ ì„¤ë¹„ëª… -->
                  <table class="table">
                     <thead>
                        <tr>
                           <th>No.</th>
                           <th>ì„¤ë¹„ëª…</th>
                           <th>ë‹´ë‹¹ì</th>
                        </tr>
                     </thead>
                     <tbody>
                        <tr th:each="fac: ${list}">
                           <td th:text="${facStat.count}"></td>
                           <td th:text="${fac.facName}" th:data-facName="${fac.facName}"
                               th:data-facNotPerson="${fac.facNotPerson}"
                              onclick="updateInputFields(this)" data-bs-dismiss="modal"></td>
                           <td th:text="${fac.facNotPerson}" ></td>
                        </tr>
                     </tbody>
                  </table>
               </div>
               <div class="modal-footer">
                  <button type="button" class="btn btn-secondary"
                     data-dismiss="modal">ë‹«ê¸°</button>
               </div>
            </div>
         </div>
      </div>
      <script th:inline="javascript">
   // ëª¨ë‹¬ì°½ ë‚´ë¶€ì— ìˆëŠ” ë°ì´í„° input ì— ë‹´ëŠ” í•¨ìˆ˜
   function updateInputFields(Element) {
      // í´ë¦­í•œ <td> ìš”ì†Œì—ì„œ ë°ì´í„° ì†ì„±ì„ ê°€ì ¸ì˜´
      var facName = Element.getAttribute('data-facName');
      var facNotPerson = Element.getAttribute('data-facNotPerson');

      // ì…ë ¥ í•„ë“œì˜ ê°’ ì„¤ì •
      document.getElementById('facName').value = facName;
      document.getElementById('facNotPerson').value = facNotPerson;

   }
   
   document.getElementById('saveBtn').addEventListener("click", function() {
          

        var facName = document.getElementsByName("facName")[0].value;
        var facNotPerson = document.getElementsByName("facNotPerson")[0].value;
        var facNotReason = document.getElementsByName("facNotReason")[0].value;
        var facNotSituation = document.getElementsByName("facNotSituation")[0].value;
        var facNotSdate = document.getElementsByName("facNotSdate")[0].value;
        var facNotLdate = document.getElementsByName("facNotLdate")[0].value;
         
        if (!facName) {
              alert("ì„¤ë¹„ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return;
          }
        
        
               var data = {
                  facName: facName,
                  facNotPerson: facNotPerson,
                  facNotReason: facNotReason,
                  facNotSituation: facNotSituation,
                  facNotSdate: facNotSdate,
                  facNotLdate: facNotLdate
               };
               
               fetch("/facNotop", {
                 method: "POST",
                 body: JSON.stringify(data),
                 headers: {
                     "Content-Type": "application/json"
                 }
             })
             .then(response => {
                console.log(response.status);
                 if (response.ok) {
                     console.log(response);
                     alert("ë“±ë¡ì™„ë£Œ!");
                 } else {
                     console.log(response);
                     alert("ë“±ë¡ì‹¤íŒ¨");
                 }
             })
             .catch(error => {
                 console.log(error);
                 alert(ì˜¤ë¥˜);
             });
         });
   
   
   // ê·¸ë¦¬ë“œ í˜ì´ì§•
   let facNotList = [[${list}]]
   console.log(facNotList);
   const grid = new tui.Grid({
	   
      
      el : document.getElementById('grid'),
      data : facNotList,
      scrollX : false,
      scrollY : false,
      columns: [
          {
              header: 'ì„¤ë¹„ì½”ë“œ',
              name: 'facCode',
              align: 'center'
          },
          {
              header: 'ì„¤ë¹„ë¹„ê°€ë™ì½”ë“œ',
              name: 'facNotCode',
              align: 'center'
          },
          {
              header: 'ì„¤ë¹„ëª…',
              name: 'facName',
              align: 'center'
          },
          {
              header: 'ë‹´ë‹¹ì',
              name: 'facNotPerson',
              align: 'center'
          },
          {
              header: 'ìƒíƒœ',
              name: 'facNotSituation',
              formatter: function(value) {
                  var numericValue = +value.value;

                  if (numericValue === 0) {
                      return 'ğŸŸ¡';
                  } else if (numericValue === 1) {
                      return 'ğŸŸ¢';
                  } else if (numericValue === 2) {
                      return 'ğŸ”´';
                  } else {
                      return 'ì•Œ ìˆ˜ ì—†ëŠ” ìƒíƒœ';
                  }
              },
              align: 'center'
          }
      ],
      rowHeaders: ['rowNum'],
      pageOptions: {
          useClient: true,
          perPage: 5
      }
  });
</script>
   </section>
</body>
</html>
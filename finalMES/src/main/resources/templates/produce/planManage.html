<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>생산계획관리</title>
</head>
<body>
	<section layout:fragment="content">
		<div class="container">
			<!-- ============================모달창============================ -->
			<div class="modal fade modal-xl" id="exampleModal" tabindex="-1"
				aria-labelledby="exampleModalLabel" aria-hidden="true">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalLabel">title</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"
								aria-label="Close"></button>
						</div>
						<!-- ============================모달 내용============================ -->
						<div class="modal-body">
							<div>
								<h4>주문서</h4>
								<!-- <button class="btn btn-secondary" style="float: right; margin: 0 5px;">선택</button> -->
								<table class="table">
									<thead>
										<tr>
											<th></th>
											<th>주문코드</th>
											<th>주문일자</th>

											<th>비고</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="ord : ${ordList}"
											th:data-ord-code="${ord.ordCode}" class="ord-row">
											<td><input type="checkbox"></td>
											<td th:text="${ord.ordCode}"></td>
											<td th:text="${#dates.format(ord.ordDate, 'yyyy-MM-dd')}"></td>
											<td th:text="${ord.ordNote}"></td>
										</tr>
									</tbody>
								</table>
							</div>

							<div id="orderDetails"></div>

						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary"
								data-bs-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary">Save
								changes</button>
						</div>
					</div>
				</div>
			</div>

			<!-- ============================메인============================ -->
			<h2>생산계획관리</h2>
			<div>
				<div>
					<button class="btn btn-secondary"
						style="float: right; margin: 0 5px;">저장</button>
					<button class="btn btn-secondary" data-bs-toggle="modal"
						data-bs-target="#exampleModal" style="float: right;">주문서
						조회</button>
					<table class="table">
						<thead>
							<tr>
								<th>No</th>
								<th>생산계획코드</th>
								<th>주문코드</th>
								<th>계획명</th>
								<th>담당자</th>
								<th>생산계획일자</th>

							</tr>
						</thead>
						<tbody>
							<th:block th:each="plan : ${list}">
								<tr>
									<td th:text="${planStat.count}"></td>
									<td th:text="${plan.planCode}"></td>
									<td th:text="${plan.ordCode}"></td>
									<td th:text="${plan.planTitle}"></td>
									<td th:text="${plan.planPerson}"></td>
									<td th:text="${#dates.format(plan.planDate, 'yyyy-MM-dd')}"></td>


								</tr>
							</th:block>
						</tbody>
					</table>
				</div>
				<!-- ============================생산상세계획============================ -->
				<div class="mt-4">
					<button class="btn btn-secondary"
						style="float: right; margin: 0 5px;">저장</button>
					<table class="table">
						<thead>
							<tr>
								<th>No</th>
								<th>생산계획코드</th>
								<th>제품코드</th>
								<th>생산계획 시작일자</th>
								<th>생산계획 종료일자</th>
								<th>현재재고</th>
								<th>주문수량</th>
								<th>계획량</th>
								<th>납기/마감일자</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>1</td>
								<td>계획코드</td>
								<td>제품코드</td>
								<td><input type="date"></td>
								<td><input type="date"></td>
								<td>현재재고</td>
								<td>주문수량</td>
								<td><input type="number"></td>
								<td><input type="text"></td>
							</tr>
						</tbody>
					</table>
				</div>

			</div>
		</div>
		<script>
		document.querySelectorAll('.ord-row').forEach(row => {
		    row.addEventListener('click', function() {
		        const ordCode = this.getAttribute('data-ord-code');
		        fetch('/orderDetail?ordCode=' + ordCode)
		            .then(response => response.json())
		            .then(data => {
		                const detailsContainer = document.getElementById('orderDetails');
		                detailsContainer.innerHTML = ''; // 기존 내용 초기화

		                // 테이블 및 thead 구성
		                const table = document.createElement('table');
		                table.className = 'table';
		                table.innerHTML = `
		                    <thead>
		                        <tr>
		                            <th>제품 코드</th>
		                            <th>주문 수량</th>
		                            <th>납기일자</th>
		                        </tr>
		                    </thead>
		                `;

		                // tbody 생성
		                const tbody = document.createElement('tbody');

		                // 상세 정보 리스트를 반복하여 tr 요소 생성 및 추가
		                data.forEach(detail => {
		                    const tr = document.createElement('tr');
		                    tr.innerHTML = `
		                        <td>${detail.prodCode}</td>
		                        <td>${detail.ordCount}</td>
		                        <td>${detail.dlvyDate}</td>
		                    `;
		                    tbody.appendChild(tr);
		                });

		                // 완성된 tbody를 테이블에 추가
		                table.appendChild(tbody);

		                // 완성된 테이블을 detailsContainer에 추가
		                detailsContainer.appendChild(table);
		            });
		    });
		});
		</script>
	</section>

</body>
</html>
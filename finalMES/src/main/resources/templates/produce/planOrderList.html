<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}">
<head>
<meta charset="UTF-8">
<title>생산지시목록</title>

</head>
<body>
	<section layout:fragment="content">
		<div class="container">
			
			
			<!-- ============================메인============================ -->
			<h2>생산지시목록</h2>
			<div>
				<div>
					<!-- <button class="btn btn-secondary" style="float: right; margin: 0 5px;">저장</button>
					<button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal" style="float: right;">생산계획서 조회</button> -->
					<table class="table table-hover">
						<thead>
							<tr>
								<th>No</th>
								<th>생산지시코드</th>
								<th>주문코드</th>
								<th>계획명</th>
								<th>담당자</th>
								<th>생산지시일자</th>
								<th>납기/마감일자</th>
							</tr>
						</thead>
						<tbody class="ins">
							<th:block th:each="ins : ${insList}">
								<tr th:data-ins-code="${ins.insCode}" class="ins-row">
									<td th:text="${insStat.count}"></td>
									<td th:text="${ins.insCode}"></td>
									<td th:text="${ins.insCode}"></td>
									<td th:text="${ins.insTitle}"></td>
									<td th:text="${ins.insPerson}"></td>
									<td th:text="${#dates.format(ins.insDate, 'yyyy-MM-dd') }"></td>
									<td th:text="${ins.insNote}"></td>
									
								</tr>
							</th:block>
						</tbody>
					</table>
				</div>
				<!-- ============================생산상세계획============================ -->
				<div class="mt-5">
					<!-- <button class="btn btn-secondary" style="float: right; margin: 0 5px;">저장</button> -->
					<table class="table table-hover">
						<thead>
							<tr>
								<th></th>
								<th>생산지시코드</th>
								<th>제품코드</th>
								<th>지시량</th>
								<th>작업시작일자</th>
								<th>작업종료일자</th>
								<th>비고</th>
							</tr>
						</thead>
						<tbody id="detailPlanOrder">
							<th:block th:each="detail : ${detailList}">
								<tr>
									<th>
										<div class="form-check">
										  <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked>
										  <label class="form-check-label" for="flexRadioDefault2"></label>
										</div>
									</th>
									<td th:text="${detail.insCode}"></td>
									<td th:text="${detail.prodCode}"></td>
									<td th:text="${detail.dInsCount}"></td>
									<td th:text="${#dates.format(detail.dInsSdate, 'yyyy-MM-dd') }"></td>
									<td th:text="${#dates.format(detail.dInsEdate, 'yyyy-MM-dd') }"></td>
									<td th:text="${detail.dInsNote}"></td>
									
								</tr>
							</th:block>
						</tbody>
					</table>
				</div>
				
				
			</div>
		</div>
	</section>
</body>
<script>
document.querySelectorAll('.ins-row').forEach(row => {
    row.addEventListener('click', function() {
        const insCode = this.getAttribute('data-ins-code');
        fetch('/planOrderDetail?insCode=' + insCode)
            .then(response => response.json())
            .then(data => {
                const detailsTbody = document.getElementById('detailPlanOrder');
                detailsTbody.innerHTML = ''; // 기존 내용 초기화

                

                

                // 상세 정보 리스트를 반복하여 tr 요소 생성 및 추가
                data.forEach(detail => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                    	<td>${detail.insCode}</td>
						<td>${detail.prodCode}</td>
						<td>${detail.dInsCount}</td>
						<td>${#dates.format(detail.dInsSdate, 'yyyy-MM-dd')</td>
						<td>${#dates.format(detail.dInsEdate, 'yyyy-MM-dd')</td>
						<td>${detail.dInsNote}</td>
                    `;
                    tbody.appendChild(tr);
                });

                
            });
    });
});
</script>

</html>